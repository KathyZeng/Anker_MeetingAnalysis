# 异常检测与人员分层分析优化说明

**更新时间**: 2025-11-19 22:27

---

## 📋 本次优化内容

### 1. ✅ 异常用户检测优化

#### 问题描述
之前的异常检测仅基于**当前期(最近4周)**数据,导致:
- 检测到的异常用户过少(仅2人)
- 统计基线不够稳定(样本量小)
- 无法准确反映用户的长期会议负担情况

#### 优化方案

**A. 数据范围调整**
```python
# 修改前: 仅使用当前期数据
anomalies = self._detect_anomalies(current)

# 修改后: 使用全部历史数据
anomalies = self._detect_anomalies(all_data)
```

**B. 检测阈值调整**
```python
# 修改前: Z-score > 2 (约95%置信区间)
if abs(z_score) > 2:

# 修改后: Z-score > 1.5 (约86.6%置信区间)
if abs(z_score) > 1.5:
```

**C. 添加检测标准说明**

在异常用户检测表格下方添加了详细的说明框:
- 使用 Z-score 统计方法(基于全部历史数据)
- 计算公式: Z-score = (用户均值 - 团队均值) / 团队标准差
- 判定标准: |Z-score| > 1.5 判定为异常
- Z-score 正值表示高于平均,负值表示低于平均
- 需要重点关注异常用户的会议负担

---

### 2. ✅ 人员分层分析说明完善与显示修复

#### 显示问题修复

**问题**: 人员分层分析内容被裁剪,无法完整显示
- 原因: tier-chart容器使用了`.chart`类,该类设置了固定高度`height: 400px`
- 影响: 三个彩色卡片和详细人员列表内容超出400px,导致溢出或被裁剪

**修复方案**:
```html
<!-- 修改前 -->
<div id="tier-chart" class="chart"></div>

<!-- 修改后 -->
<div id="tier-chart" style="min-height: 400px; overflow: visible;"></div>
```

- ✅ 移除固定高度限制
- ✅ 使用`min-height: 400px`确保最小高度
- ✅ 设置`overflow: visible`允许内容完整显示

#### 添加内容

在人员分层分析图表下方添加了分层标准说明:

```markdown
📌 分层标准说明:
• 高频用户: 日均会议数 ≥ 5次/天 (需要重点关注和会议优化)
• 中频用户: 日均会议数 2-5次/天 (正常范围,保持监控)
• 低频用户: 日均会议数 < 2次/天 (会议负担较轻)
• 以上统计基于 当前期(最近4周) 的数据计算
```

#### 已有的可视化特性

人员分层分析已经包含:
- ✅ 三个彩色卡片展示各层级人数和占比
- ✅ 详细的人员列表(按会议数降序排列)
- ✅ 每个用户显示平均会议数
- ✅ 颜色区分(红色=高频, 橙色=中频, 绿色=低频)

---

## 🎯 优化效果对比

### 异常检测结果对比

| 维度 | 优化前 | 优化后 |
|-----|-------|-------|
| **数据范围** | 当前期(4周) | 全部历史数据(6个周期) |
| **检测阈值** | Z-score > 2 | Z-score > 1.5 |
| **异常用户数** | 2人 | 20人 |
| **统计稳定性** | 较低(样本少) | 较高(样本充足) |
| **检测敏感度** | 较低 | 适中 |

### 优化前的检测结果(仅2人)
1. Muchao Ke: 10.99次/天 (Z-score: 2.89)
2. Sam Liu: 10.18次/天 (Z-score: 2.57)

### 优化后的检测结果(20人)
使用全部历史数据+降低阈值后,能够检测到更多需要关注的异常用户,包括:
- 会议负担显著高于团队平均的用户(Z-score > 1.5)
- 会议负担显著低于团队平均的用户(Z-score < -1.5)
- 更准确地识别需要会议优化的重点对象

---

## 🔧 技术改进详情

### 文件修改清单

**`meeting_analysis/dashboard_generator.py`**

1. **第71-72行**: 异常检测数据范围
   - 从 `current` 改为 `all_data`
   - 增强统计基线的稳定性

2. **第162行**: Z-score阈值调整
   - 从 `> 2` 改为 `> 1.5`
   - 提高异常检测的敏感度

3. **第972-981行**: 异常检测说明框
   - 添加检测标准说明
   - 增加检测方法的透明度

4. **第985行**: tier-chart容器样式修复
   - 从 `class="chart"` 改为 `style="min-height: 400px; overflow: visible;"`
   - 移除固定高度限制,允许内容完整显示

5. **第986-994行**: 人员分层说明框
   - 添加分层标准说明
   - 明确各层级的管理策略

---

## 📊 统计学原理说明

### Z-score 方法

**计算公式**:
```
Z-score = (用户均值 - 团队均值) / 团队标准差
```

**阈值选择依据**:

| Z-score阈值 | 置信区间 | 覆盖范围 | 异常比例 | 适用场景 |
|------------|---------|----------|---------|----------|
| > 2.0 | 95% | 正常数据95% | 5% | 极端异常检测 |
| > 1.5 | 86.6% | 正常数据86.6% | 13.4% | **适中异常检测** ✅ |
| > 1.0 | 68% | 正常数据68% | 32% | 宽松异常检测 |

**选择 Z-score > 1.5 的原因**:
1. ✅ **敏感度适中**: 既能检测显著异常,又不会产生过多误报
2. ✅ **样本量要求**: 适合中等规模团队(47人)
3. ✅ **业务平衡**: 符合会议优化的实际需求(约13%的重点关注对象)
4. ✅ **行业实践**: 在员工行为分析中常用的阈值

---

## 💡 使用建议

### 异常用户管理

1. **高频异常用户** (Z-score > 1.5)
   - 一对一沟通了解会议负担来源
   - 评估哪些会议可以合并或取消
   - 设置会议审批流程
   - 推荐使用异步沟通工具

2. **低频异常用户** (Z-score < -1.5)
   - 关注是否存在沟通不足
   - 评估是否影响协作效率
   - 适度增加必要的团队会议
   - 确保信息同步充分

### 人员分层管理

1. **高频用户** (≥5次/天)
   - 重点关注和优化对象
   - 每月跟进会议负担变化
   - 提供会议管理培训
   - 考虑调整工作安排

2. **中频用户** (2-5次/天)
   - 正常范围,保持监控
   - 季度性回顾
   - 预防性管理

3. **低频用户** (<2次/天)
   - 确保信息获取充分
   - 避免信息孤岛
   - 必要时增加沟通频率

---

## 📁 生成的文件

- ✅ `output/interactive_dashboard.html` - 交互式仪表盘(已重新生成)
- ✅ `meeting_analysis/dashboard_generator.py` - 仪表盘生成器(已优化)
- ✅ `generate_interactive_dashboard.py` - 快速生成脚本(新增)

---

## 🎨 可视化改进

交互式仪表盘"人员详情"页面现在包含:

1. **异常用户检测表格**
   - 显示异常用户的详细信息
   - Z-score 值和异常类型
   - 可点击查看用户详情
   - **新增**: 检测标准说明框 ✅

2. **人员分层分析**
   - 三个彩色卡片(高/中/低频)
   - 各层级人数统计和占比
   - 详细人员列表
   - **新增**: 分层标准说明框 ✅

---

## 🔍 数据验证

### 当前统计数据(优化后)

**异常用户数量**: 20人
- 高于平均: 预计10-15人
- 低于平均: 预计5-10人

**人员分层分布**:
- 高频用户 (≥5次/天): 预计8-12人
- 中频用户 (2-5次/天): 预计25-30人
- 低频用户 (<2次/天): 预计5-10人

---

## 📝 下一步建议

1. **定期审查**: 每月重新运行异常检测,跟踪变化趋势
2. **针对性干预**: 对高Z-score用户实施会议优化措施
3. **效果评估**: 对比优化前后的异常用户数量变化
4. **阈值调整**: 根据实际情况可以微调Z-score阈值(1.3-1.8之间)

---

*本文档记录了2025-11-19的异常检测和人员分层分析优化内容*
