# 会议改善效果分析系统 V2.0 - 需求与技术方案

**创建时间**: 2025-11-20
**版本**: V2.0 设计方案
**状态**: 待确认

---

## 📋 第一部分：核心诉求梳理

### 🎯 当前系统分析（V1.0）

**现有功能**:
1. ✅ 手动放置CSV文件到input目录
2. ✅ 运行Python脚本生成仪表盘
3. ✅ 静态HTML展示（月度数据对比）
4. ✅ 基线期 vs 当前期的KPI对比
5. ✅ 单次生成，无历史数据管理

**现有架构**:
```
input/ (手动放置CSV)
  └── 9月会议详情.csv
  └── 10月会议详情.csv
      ↓
generate_full_dashboard.py (命令行执行)
      ↓
meeting_analysis/ (数据处理)
  ├── data_loader.py
  ├── calculator.py
  ├── analyzer.py
  ├── dashboard_generator.py
  └── full_dashboard_gen.py
      ↓
output/meeting_dashboard_full.html (静态输出)
```

---

### 🚀 V2.0 核心诉求识别

#### 1. **数据管理需求**

##### 1.1 数据上传功能 ⭐ 新增
- **需求描述**:
  - 提供Web界面上传CSV文件
  - 支持拖拽上传
  - 自动解析文件名识别周期（如"11.03-11.09会议详情.csv"）
  - 上传后自动验证数据格式

- **补充建议**:
  - ✅ 支持批量上传（一次上传多周数据）
  - ✅ 上传历史记录（谁在什么时候上传了什么文件）
  - ✅ 数据预览（上传前预览前10行）
  - ✅ 错误提示（列名不匹配、格式错误等）

##### 1.2 数据存储与版本管理 ⭐ 新增
- **需求描述**:
  - 以周为维度存储历史数据
  - 每周数据独立管理
  - 支持数据的增删改查

- **补充建议**:
  - ✅ SQLite本地数据库（轻量级，无需服务器）
  - ✅ 数据备份机制（自动备份到backup/目录）
  - ✅ 数据恢复功能（误删后可恢复）
  - ✅ 数据导出功能（导出为CSV或Excel）

#### 2. **可视化展示需求**

##### 2.1 周度分析仪表盘 ⭐ 核心
- **需求描述**:
  - 保持现有界面设计风格
  - 支持选择不同周期进行对比
  - 数据更新后自动刷新图表

- **补充建议**:
  - ✅ 周期选择器（下拉菜单选择基线周和对比周）
  - ✅ 多周趋势图（显示连续多周的KPI变化趋势）
  - ✅ 同比环比分析（本周 vs 上周 vs 上月同周）
  - ✅ 实时刷新（上传数据后无需重新生成页面）

##### 2.2 界面一致性 ⭐ 重要
- **需求描述**:
  - 所有页面风格统一
  - 配色方案一致
  - 图表类型和布局保持一致

- **补充建议**:
  - ✅ 模板化设计（统一的Header、Footer、侧边栏）
  - ✅ 响应式布局（适配不同屏幕尺寸）
  - ✅ 主题切换（可选：浅色/深色主题）
  - ✅ 样式配置文件（CSS独立管理）

#### 3. **交互与操作需求**

##### 3.1 数据筛选与查询 ⭐ 新增
- **需求描述**:
  - 按周期筛选数据
  - 按用户筛选数据
  - 按部门筛选数据（如果CSV中有部门信息）

- **补充建议**:
  - ✅ 多维度筛选组合（周期+用户+部门）
  - ✅ 快速日期选择器（本周、上周、本月、上月等）
  - ✅ 模糊搜索（用户名模糊匹配）
  - ✅ 筛选条件保存（记住上次的筛选设置）

##### 3.2 数据导出与报告 ⭐ 新增
- **需求描述**:
  - 导出当前视图为PDF
  - 导出原始数据为Excel

- **补充建议**:
  - ✅ 一键生成周报（PDF格式，包含图表和分析）
  - ✅ 导出图表为图片（PNG/SVG）
  - ✅ 分享链接（生成只读分享链接）
  - ✅ 打印优化（打印时自动调整布局）

##### 3.3 用户管理 ⭐ 可选
- **需求描述**:
  - 简单的登录认证（可选）
  - 不同用户看到不同数据（可选）

- **补充建议**:
  - ⚠️ 如果是个人使用，可以不需要
  - ⚠️ 如果是团队使用，建议添加：
    - 用户角色（管理员、普通用户）
    - 数据权限（全部数据 vs 仅看自己的数据）
    - 操作日志（记录谁做了什么操作）

#### 4. **系统维护需求**

##### 4.1 本地版本控制 ⭐ 重要
- **需求描述**:
  - Git版本管理
  - 代码变更记录
  - 回滚能力

- **补充建议**:
  - ✅ 自动Git提交（每次数据更新自动commit）
  - ✅ 版本标签（每个发布版本打tag）
  - ✅ 变更日志（CHANGELOG.md记录每次更新内容）
  - ✅ 备份策略（每周自动备份整个项目）

##### 4.2 配置管理 ⭐ 新增
- **需求描述**:
  - 可配置的参数（如基线期定义、KPI阈值等）
  - 配置修改后无需改代码

- **补充建议**:
  - ✅ config.yaml配置文件（集中管理所有配置）
  - ✅ 可视化配置界面（通过Web界面修改配置）
  - ✅ 配置版本控制（配置修改也纳入Git）
  - ✅ 配置验证（修改配置时自动验证合法性）

##### 4.3 日志与监控 ⭐ 新增
- **需求描述**:
  - 记录系统运行日志
  - 错误追踪

- **补充建议**:
  - ✅ 分级日志（DEBUG/INFO/WARNING/ERROR）
  - ✅ 日志轮转（避免日志文件过大）
  - ✅ 错误邮件通知（可选）
  - ✅ 性能监控（数据加载时间、图表渲染时间）

---

## 🎨 第二部分：技术架构设计

### 架构选择：轻量级Web应用

**技术栈**:
```
前端: HTML5 + CSS3 + JavaScript (原生)
      └── ECharts 5.x (图表)
      └── 无需框架（保持轻量）

后端: Python 3.9+ Flask (轻量级Web框架)
      ├── Flask (Web服务)
      ├── Pandas (数据处理)
      ├── SQLite (数据存储)
      └── 原有的meeting_analysis模块（复用）

版本控制: Git
数据库: SQLite (嵌入式，无需独立服务器)
部署: 本地运行 (127.0.0.1:5000)
```

---

### 📁 V2.0 项目结构设计

```
meeting-analysis-system-v2/
│
├── 📁 app/                              # 应用核心目录
│   ├── 📄 __init__.py                   # Flask应用初始化
│   ├── 📄 config.py                     # 配置管理
│   │
│   ├── 📁 routes/                       # 路由（API接口）
│   │   ├── __init__.py
│   │   ├── upload.py                    # 数据上传接口
│   │   ├── dashboard.py                 # 仪表盘接口
│   │   ├── data_management.py           # 数据管理接口
│   │   └── export.py                    # 导出接口
│   │
│   ├── 📁 services/                     # 业务逻辑层
│   │   ├── __init__.py
│   │   ├── data_service.py              # 数据处理服务
│   │   ├── analysis_service.py          # 分析服务
│   │   └── export_service.py            # 导出服务
│   │
│   ├── 📁 models/                       # 数据模型
│   │   ├── __init__.py
│   │   ├── database.py                  # 数据库连接
│   │   ├── meeting_data.py              # 会议数据模型
│   │   └── upload_history.py            # 上传历史模型
│   │
│   ├── 📁 core/                         # 核心分析模块（复用V1）
│   │   ├── __init__.py
│   │   ├── data_loader.py               # 从V1迁移
│   │   ├── calculator.py                # 从V1迁移
│   │   ├── analyzer.py                  # 从V1迁移
│   │   └── dashboard_generator.py       # 从V1迁移，改为API
│   │
│   ├── 📁 static/                       # 静态资源
│   │   ├── css/
│   │   │   ├── main.css                 # 主样式
│   │   │   ├── dashboard.css            # 仪表盘样式
│   │   │   └── theme-light.css          # 浅色主题
│   │   ├── js/
│   │   │   ├── main.js                  # 主逻辑
│   │   │   ├── upload.js                # 上传功能
│   │   │   ├── dashboard.js             # 仪表盘交互
│   │   │   └── charts.js                # 图表渲染
│   │   ├── img/
│   │   │   └── logo.png
│   │   └── lib/
│   │       └── echarts.min.js           # ECharts库
│   │
│   └── 📁 templates/                    # HTML模板
│       ├── base.html                    # 基础模板
│       ├── index.html                   # 首页（概览）
│       ├── upload.html                  # 上传页面
│       ├── dashboard.html               # 仪表盘
│       ├── data_management.html         # 数据管理
│       └── settings.html                # 设置页面
│
├── 📁 data/                             # 数据存储目录
│   ├── database.db                      # SQLite数据库
│   ├── uploads/                         # 上传的CSV文件
│   │   ├── 2025-11-03_to_2025-11-09.csv
│   │   ├── 2025-11-10_to_2025-11-16.csv
│   │   └── ...
│   └── exports/                         # 导出文件
│       └── weekly_report_2025W45.pdf
│
├── 📁 backups/                          # 自动备份目录
│   ├── 2025-11-20_100000/
│   │   ├── database.db
│   │   └── uploads/
│   └── ...
│
├── 📁 logs/                             # 日志目录
│   ├── app.log                          # 应用日志
│   ├── error.log                        # 错误日志
│   └── access.log                       # 访问日志
│
├── 📁 tests/                            # 测试目录
│   ├── __init__.py
│   ├── test_data_service.py
│   ├── test_analysis_service.py
│   └── test_api.py
│
├── 📁 migrations/                       # 数据库迁移脚本
│   ├── 001_initial_schema.sql
│   └── 002_add_department_field.sql
│
├── 📁 docs/                             # 文档目录
│   ├── API文档.md
│   ├── 用户手册.md
│   ├── 开发指南.md
│   └── 更新日志.md
│
├── 📄 run.py                            # 应用启动脚本
├── 📄 config.yaml                       # 配置文件
├── 📄 requirements.txt                  # Python依赖
├── 📄 .gitignore                        # Git忽略配置
├── 📄 README.md                         # 项目说明
└── 📄 CHANGELOG.md                      # 变更日志
```

---

### 🔧 核心技术实现方案

#### 1. **数据流设计**

```
┌─────────────┐
│  用户上传CSV  │
└──────┬──────┘
       ↓
┌─────────────────────────────────────┐
│ Flask上传接口 (/api/upload)          │
│  1. 验证文件格式                      │
│  2. 解析周期信息                      │
│  3. 数据格式校验                      │
└──────┬──────────────────────────────┘
       ↓
┌─────────────────────────────────────┐
│ DataService.save_to_database()       │
│  1. 保存CSV到uploads/               │
│  2. 数据入SQLite数据库               │
│  3. 记录上传历史                     │
└──────┬──────────────────────────────┘
       ↓
┌─────────────────────────────────────┐
│ AnalysisService.analyze()            │
│  1. 调用core模块（复用V1代码）        │
│  2. 计算KPI指标                      │
│  3. 生成图表数据                     │
└──────┬──────────────────────────────┘
       ↓
┌─────────────────────────────────────┐
│ 返回JSON数据给前端                    │
│  {                                  │
│    "kpi": {...},                    │
│    "charts": {...},                 │
│    "insights": [...]                │
│  }                                  │
└──────┬──────────────────────────────┘
       ↓
┌─────────────────────────────────────┐
│ 前端ECharts渲染                      │
│  - 动态更新图表                      │
│  - 保持V1的样式                      │
└─────────────────────────────────────┘
```

#### 2. **数据库设计**

**表结构**:

```sql
-- 会议数据表（周度汇总）
CREATE TABLE meeting_data (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    week_start DATE NOT NULL,           -- 周开始日期
    week_end DATE NOT NULL,             -- 周结束日期
    user_name TEXT NOT NULL,            -- 用户名
    daily_meeting_count REAL,           -- 日人均线上会议数
    daily_meeting_duration REAL,        -- 日人均线上会议时长(分钟)
    instant_meetings INTEGER,           -- 即时会议
    scheduled_meetings INTEGER,         -- 日程会议
    calls_1v1 INTEGER,                  -- 1v1通话数
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(week_start, week_end, user_name)
);

-- 上传历史表
CREATE TABLE upload_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    filename TEXT NOT NULL,             -- 原始文件名
    filepath TEXT NOT NULL,             -- 存储路径
    week_start DATE NOT NULL,
    week_end DATE NOT NULL,
    record_count INTEGER,               -- 记录数
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 配置表（存储动态配置）
CREATE TABLE system_config (
    key TEXT PRIMARY KEY,
    value TEXT,
    description TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 索引
CREATE INDEX idx_meeting_data_week ON meeting_data(week_start, week_end);
CREATE INDEX idx_meeting_data_user ON meeting_data(user_name);
CREATE INDEX idx_upload_history_week ON upload_history(week_start);
```

#### 3. **API接口设计**

```python
# 数据上传
POST /api/upload
  - 参数: file (CSV文件)
  - 返回: {success: true, week_info: {...}, record_count: 264}

# 获取周期列表
GET /api/weeks
  - 返回: [{week_start: "2025-09-01", week_end: "2025-09-07", record_count: 264}, ...]

# 获取仪表盘数据
GET /api/dashboard?baseline_start=2025-09-01&baseline_end=2025-09-30&current_start=2025-10-01&current_end=2025-10-31
  - 返回: {kpi: {...}, charts: {...}, insights: [...]}

# 获取原始数据
GET /api/data?week_start=2025-11-03&week_end=2025-11-09&user_name=张三
  - 返回: [{user_name: "张三", ...}, ...]

# 删除周数据
DELETE /api/data?week_start=2025-11-03&week_end=2025-11-09
  - 返回: {success: true, deleted_count: 264}

# 导出报告
POST /api/export/pdf
  - 参数: {baseline_start, baseline_end, current_start, current_end}
  - 返回: PDF文件下载

# 获取配置
GET /api/config
  - 返回: {baseline_months: 3, kpi_thresholds: {...}}

# 更新配置
POST /api/config
  - 参数: {key: "baseline_months", value: "3"}
  - 返回: {success: true}
```

#### 4. **前端交互设计**

**页面导航**:
```
┌────────────────────────────────────────┐
│  顶部导航栏                              │
│  [Logo] 概览 | 上传数据 | 数据管理 | 设置 │
└────────────────────────────────────────┘
```

**概览页面**（类似V1的首页）:
```
┌─────────────────────────────────────────┐
│ 📊 会议改善效果评估系统 V2.0              │
│                                         │
│ [选择基线周期] [选择对比周期] [刷新数据]    │
│                                         │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐        │
│ │KPI1 │ │KPI2 │ │KPI3 │ │KPI4 │        │
│ └─────┘ └─────┘ └─────┘ └─────┘        │
│                                         │
│ [会议类型分布] [趋势图] [原始数据表]       │
└─────────────────────────────────────────┘
```

**上传页面**:
```
┌─────────────────────────────────────────┐
│ 📤 上传会议数据                          │
│                                         │
│ ┌───────────────────────────────────┐  │
│ │  拖拽文件到这里                     │  │
│ │  或点击选择文件                     │  │
│ │                                   │  │
│ │  支持格式: CSV                     │  │
│ │  文件命名: 11.03-11.09会议详情.csv │  │
│ └───────────────────────────────────┘  │
│                                         │
│ 上传历史:                               │
│ ✅ 2025-11-10~11-16 (264条) - 刚刚上传  │
│ ✅ 2025-11-03~11-09 (264条) - 1小时前  │
└─────────────────────────────────────────┘
```

#### 5. **可扩展性设计**

**插件化架构**:
```python
# app/services/plugin_base.py
class AnalysisPlugin:
    """分析插件基类"""
    def analyze(self, data):
        raise NotImplementedError

# app/services/plugins/meeting_type_plugin.py
class MeetingTypeAnalysisPlugin(AnalysisPlugin):
    """会议类型分析插件"""
    def analyze(self, data):
        # 实现具体分析逻辑
        pass

# 注册插件
PLUGINS = [
    MeetingTypeAnalysisPlugin(),
    UserBehaviorAnalysisPlugin(),
    # 未来可以轻松添加新插件
]
```

**配置驱动**:
```yaml
# config.yaml
app:
  name: "会议改善效果评估系统"
  version: "2.0.0"
  debug: false

database:
  path: "data/database.db"
  backup_enabled: true
  backup_interval: 7  # 天

analysis:
  baseline_definition: "first_month"  # first_month | custom
  kpi_thresholds:
    meeting_count_warning: 5.0
    meeting_duration_warning: 180

upload:
  max_file_size: 10485760  # 10MB
  allowed_extensions: [".csv"]
  auto_backup: true

display:
  theme: "light"  # light | dark
  items_per_page: 20
  chart_colors:
    primary: "#4299e1"
    success: "#48bb78"
    warning: "#ed8936"
    danger: "#f56565"
```

#### 6. **版本控制策略**

**Git工作流**:
```bash
main                    # 稳定版本
  ├── v1.0             # V1备份分支
  └── v2.0-dev         # V2开发分支
      ├── feature-upload      # 功能分支
      ├── feature-dashboard
      └── feature-export

# 版本标签
v1.0.0  # V1最终版本
v2.0.0-alpha  # V2测试版
v2.0.0  # V2正式版
```

**自动备份脚本**:
```python
# app/utils/backup.py
def auto_backup():
    """每周自动备份"""
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_dir = f"backups/{timestamp}"

    # 备份数据库
    shutil.copy("data/database.db", f"{backup_dir}/database.db")

    # 备份上传文件
    shutil.copytree("data/uploads", f"{backup_dir}/uploads")

    # Git提交
    os.system(f'git add -A && git commit -m "Auto backup {timestamp}"')
```

---

## ✅ 第三部分：实施计划

### Phase 1: 基础框架搭建（第1-2天）
- [ ] 创建V2项目结构
- [ ] 配置Flask应用
- [ ] 设计并创建SQLite数据库
- [ ] 实现基础路由和模板

### Phase 2: 数据管理功能（第3-4天）
- [ ] 实现文件上传接口
- [ ] 实现数据解析和入库
- [ ] 实现数据查询和管理界面
- [ ] 实现数据删除和恢复

### Phase 3: 核心分析功能迁移（第5-6天）
- [ ] 迁移V1的core模块
- [ ] 改造为API接口
- [ ] 实现周期选择逻辑
- [ ] 实现KPI计算服务

### Phase 4: 前端界面开发（第7-8天）
- [ ] 实现仪表盘页面（复用V1样式）
- [ ] 实现图表动态渲染
- [ ] 实现周期选择器
- [ ] 实现数据筛选功能

### Phase 5: 导出与报告（第9天）
- [ ] 实现PDF导出
- [ ] 实现Excel导出
- [ ] 实现图表截图

### Phase 6: 测试与优化（第10天）
- [ ] 单元测试
- [ ] 集成测试
- [ ] 性能优化
- [ ] 文档完善

---

## 🎯 关键决策点（需要你确认）

### 决策点1: 部署方式
**选项A**: 纯本地应用（推荐）
- ✅ 无需服务器
- ✅ 数据完全本地
- ✅ 启动即用（python run.py）
- ❌ 仅本机访问

**选项B**: 局域网应用
- ✅ 团队内多人访问
- ✅ 数据集中管理
- ❌ 需要配置网络
- ❌ 需要考虑并发

**👉 建议选择: A（纯本地）**

---

### 决策点2: 用户认证
**选项A**: 无认证（推荐）
- ✅ 简单直接
- ✅ 快速启动
- ❌ 无权限控制

**选项B**: 简单密码保护
- ✅ 基础安全
- ❌ 增加复杂度

**选项C**: 完整用户系统
- ✅ 多用户管理
- ❌ 显著增加复杂度

**👉 建议选择: A（无认证），如果是个人使用**

---

### 决策点3: 数据迁移
**选项A**: 自动迁移V1数据
- ✅ 保留历史数据
- ❌ 需要写迁移脚本

**选项B**: 重新开始
- ✅ 干净的开始
- ❌ 丢失历史数据

**👉 建议选择: A（自动迁移）**

---

### 决策点4: 界面风格
**选项A**: 完全继承V1样式
- ✅ 无学习成本
- ✅ 视觉一致性

**选项B**: 现代化改版
- ✅ 更好的交互体验
- ❌ 需要重新适应

**👉 建议选择: A（继承V1）**

---

### 决策点5: 功能优先级
**必需功能**（V2.0.0）:
1. ✅ 文件上传
2. ✅ 周度数据管理
3. ✅ 仪表盘展示（复用V1样式）
4. ✅ 周期选择对比
5. ✅ 本地版本控制

**可选功能**（V2.1.0）:
1. ⚠️ PDF导出
2. ⚠️ 多周趋势图
3. ⚠️ 配置界面
4. ⚠️ 数据备份恢复

**未来功能**（V3.0.0）:
1. 📅 用户认证
2. 📅 部门维度分析
3. 📅 AI智能洞察
4. 📅 移动端适配

**👉 建议选择: 先完成必需功能，验证后再迭代**

---

## 📦 技术栈详细清单

### 后端
```txt
Flask==3.0.0           # Web框架
Pandas==2.1.0          # 数据处理
SQLAlchemy==2.0.0      # ORM（可选，也可以用纯SQL）
PyYAML==6.0            # 配置文件解析
WeasyPrint==60.0       # PDF生成（可选）
openpyxl==3.1.0        # Excel导出
python-dateutil==2.8.2 # 日期处理
```

### 前端
```txt
原生JavaScript（ES6+）
ECharts 5.4.3
HTML5 + CSS3（Flexbox/Grid）
无需npm、webpack等构建工具（保持简单）
```

### 开发工具
```txt
Git
SQLite Browser（数据库查看工具）
VS Code + Python插件
```

---

## 🎬 下一步行动

### 请你确认以下问题：

1. **部署方式**: 纯本地应用（推荐） or 局域网应用？
2. **用户认证**: 不需要（推荐） or 需要简单密码保护？
3. **V1数据迁移**: 自动迁移历史数据（推荐） or 重新开始？
4. **界面风格**: 完全继承V1（推荐） or 现代化改版？
5. **功能范围**: 仅必需功能（推荐） or 包含可选功能？
6. **数据库方案**: SQLite（推荐） or 其他？
7. **是否需要部门维度**: 需要 or 不需要（当前CSV没有部门字段）？
8. **周期命名规则**: 使用文件名中的日期（如"11.03-11.09"） or 让用户手动输入？

### 确认后我将：

1. 创建完整的V2项目结构
2. 迁移V1核心代码到新架构
3. 实现基础的上传和展示功能
4. 提供详细的使用文档
5. 设置Git版本控制

---

**请回复你的选择，我会根据你的决策生成相应的项目代码！** 🚀
